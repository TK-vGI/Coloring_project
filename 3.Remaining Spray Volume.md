# Stage 3/6: Remaining Spray Volume
## Description
After exploring the colors used on your canvas, take a peek into the spray cans. The next step is to discover how  
much paint is left in each can after all the paintings. Uncover the final touches to your vibrant journey by  
understanding the remaining volumes in each spray can.

## Objectives
- Identify the `id` of spray cans from the `Spray` table and their remaining volumes after all paintings from  
    the `Painting` table in the coloring database.
- Use a query that selects the spray ID from the `Spray` table and calculates the remaining volume by subtracting
  the sum of paint volume from the `Painting` table. Ensure results are sorted by spray ids.
- Use the `COALESCE` function to deal with the `NULL` values or in other words with the spray cans that were not been used for painting.
- Utilize the `GROUP BY` and `JOIN` functions to accomplish the task.
- The column order is essential.


Take a look at the following database structure:

![Explanation of the database](./IMG1.png)

## Explanation of the database:
The Coloring Database encompasses three main tables: painting, spray, square.

In-depth details of each table are as follows:

The `**Square**`** table represents individual squares that can be painted using spray cans. It contains the following columns:
  - `id`: A unique identifier for each square.
  - `name`: The name or label associated with the square.

The `**Spray**`** table contains information about different spray paint cans. It includes the following columns:
  - `id`: A unique identifier for each spray can. 
  - `name`: The name or label associated with the spray can.
  - `color`: The color of the spray can, is represented only by a single character ('R' for red, 'G' for green, 'B' for blue).

The `**Painting**`** table is used to track the painting activity on squares using spray cans. It includes the following columns:
  - `datetime`: The timestamp indicating when the painting occurred with an accuracy of a second, not milliseconds.
  - `square_id`: A reference to the square being painted, linking to the id column in the Square table.
  - `spray_id`: A reference to the spray can be used for painting, linking to the id column in the Spray table.
  - `volume`: The amount of paint applied during the painting process.

## Additional information and rules to consider:
- The volume of the spray can is `initially set to 255`, and it decreases as the can is used for painting.
- The color of the square is determined by the RGB rule, with (R=0, G=0, B=0) representing `black` and  
  (R=255, G=255, B=255) representing `white`.
- The entry in the Painting table `reduces` the amount of paint in the spray can by the specified volume column  
  and `increases` the amount of paint in the square by the same amount.
- The volume value should be in the range of` 0 < volume <= 255`.
- The amount of paint in a square of the `same color cannot exceed 255`, and  
  the amount of paint in a `spray can not be less than zero`.

** Table names are case-sensitive

Click on the [link](Database.sql) to download the SQL query for creating the database.

## Example

_Spray Table Example:_

| id | name    | color |
|----|---------|-------|
| 1  | Baloon1 | R     |
| 2  | Baloon2 | B     |
| 3  | Baloon3 | G     |
| 4  | Baloon4 | R     |
| 5  | Baloon5 | G     |

_Painting Table Example:_

| datetime            | square_id | spray_id | volume |
|---------------------|-----------|----------|--------|
| 2020-01-01 01:13:36 | 1         | 1        | 255    |
| 2020-01-01 02:13:36 | 1         | 2        | 200    |
| 2020-01-01 03:13:36 | 1         | 3        | 105    |
| 2020-01-01 04:13:36 | 1         | 3        | 100    |
| 2020-01-01 05:13:36 | 2         | 4        | 50     |

From the data presented in the table above, it is evident that spray cans with id `1` have expended a volume of `255`,  
as observed in the Painting table. The remaining volume for a spray with ID 1 will be equal to 255 - 255, resulting in `0`.  
On the other side, a spray can with id `5` exists in the Spray table but is absent in the Painting table,  
indicating that this spray can have not been used and has a remaining volume of `255`. Similarly, the remaining volume  
for other spray cans is calculated. The output table, after identifying the remaining volume in each spray can  
after all paintings, with the sorting by spray ids:

| id | remaining_volume |
|----|------------------|
| 1  | 0                |
| 2  | 55               |
| 3  | 50               |
| 4  | 205              |
| 5  | 255              |
|    |                  |


_From the output above, it can be seen that the order of the columns is `id`-> `remaining_volume`_

## Query template:
```markdown
SELECT s.id, 255 - ... AS remaining_volume ...;
```